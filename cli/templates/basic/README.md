# NSBP

ðŸŒ **Online Demo**: [https://nsbp.erishen.cn/](https://nsbp.erishen.cn/)

## çŽ¯å¢ƒå˜é‡é…ç½®

### å¿«é€Ÿå¼€å§‹

```bash
# 1. å¤åˆ¶çŽ¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# 2. æ ¹æ®éœ€è¦ç¼–è¾‘ .env æ–‡ä»¶
# ç¼–è¾‘ NODE_ENVã€PORTã€ENABLE_RATE_LIMIT ç­‰

# 3. å¼€å§‹å¼€å‘æˆ–éƒ¨ç½²
pnpm run dev              # æœ¬åœ°å¼€å‘
docker-compose up -d         # Docker éƒ¨ç½²
```

### çŽ¯å¢ƒå˜é‡è¯´æ˜Ž

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜Ž | æŽ¨èçŽ¯å¢ƒ |
|-------|--------|------|---------|
| `NODE_ENV` | development | è¿è¡ŒçŽ¯å¢ƒ (development/production) | å…¨éƒ¨ |
| `PORT` | 3001 | æœåŠ¡ç«¯å£ | å…¨éƒ¨ |
| `ENABLE_RATE_LIMIT` | 0 | å¯ç”¨é€ŸçŽ‡é™åˆ¶ (1=å¯ç”¨, 0=ç¦ç”¨) | ç”Ÿäº§çŽ¯å¢ƒ |
| `DEBUG` | - | å¯ç”¨è°ƒè¯•æ—¥å¿— | å¼€å‘çŽ¯å¢ƒ |
| `TZ` | Asia/Shanghai | æ—¶åŒºé…ç½® | ç”Ÿäº§çŽ¯å¢ƒ |

### é…ç½®æ–‡ä»¶è¯´æ˜Ž

- **`.env.example`** - çŽ¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆæäº¤åˆ° Gitï¼‰
- **`.env`** - æœ¬åœ°å¼€å‘é…ç½®ï¼ˆä¸æäº¤åˆ° Gitï¼‰
- **`.env.production`** - ç”Ÿäº§çŽ¯å¢ƒé…ç½®ï¼ˆä¸æäº¤åˆ° Gitï¼‰
- **`.env.development`** - å¼€å‘çŽ¯å¢ƒé…ç½®ï¼ˆä¸æäº¤åˆ° Gitï¼‰
- **`.env.local`** - æœ¬åœ°æ•æ„Ÿä¿¡æ¯ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼Œä¸æäº¤åˆ° Gitï¼‰

### é…ç½®ä¼˜å…ˆçº§

```
.env.local > .env > docker-compose.yml é»˜è®¤å€¼
```

### æœ¬åœ°å¼€å‘é…ç½®

```bash
# å¤åˆ¶å¼€å‘çŽ¯å¢ƒé…ç½®
cp .env.development .env

# æˆ–æ‰‹åŠ¨åˆ›å»º .env æ–‡ä»¶
cat > .env << EOF
NODE_ENV=development
PORT=3001
ENABLE_RATE_LIMIT=0
EOF

# å¯åŠ¨å¼€å‘çŽ¯å¢ƒ
pnpm run dev
```

### Docker éƒ¨ç½²é…ç½®

```bash
# ç”Ÿäº§çŽ¯å¢ƒé…ç½®
cp .env.production .env

# Docker Compose ä¼šè‡ªåŠ¨è¯»å– .env æ–‡ä»¶
docker-compose up -d

# æŸ¥çœ‹çŽ¯å¢ƒå˜é‡æ˜¯å¦ç”Ÿæ•ˆ
docker-compose exec app env | grep NODE_ENV
```

### æ•æ„Ÿä¿¡æ¯ç®¡ç†

**é‡è¦ï¼š**
- âœ… `.env.example` å¯ä»¥æäº¤åˆ° Gitï¼ˆæ¨¡æ¿æ–‡ä»¶ï¼‰
- âŒ `.env`ã€`.env.local` ä¸è¦æäº¤åˆ° Gitï¼ˆå·²åœ¨ .gitignore ä¸­ï¼‰
- âœ… æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†é’¥ã€æ•°æ®åº“å¯†ç ï¼‰æ”¾åœ¨ `.env.local` ä¸­
- âœ… `.env.local` ä¼šè¦†ç›–å…¶ä»–é…ç½®ï¼Œä¼˜å…ˆçº§æœ€é«˜

## å¼€å‘
- pnpm run dev   (å¼€å‘è¿è¡Œ)
- pnpm run build (ç”Ÿäº§ç¼–è¯‘)
- pnpm start     (ç”Ÿäº§è¿è¡Œ)

### æœ¬åœ°è®¿é—®

å®¢æˆ·ç«¯æ¸²æŸ“
http://localhost:3001/

æœåŠ¡ç«¯æ¸²æŸ“
http://localhost:3001/?seo=1

æœåŠ¡ç«¯æ¸²æŸ“ä¸æˆåŠŸï¼Œæ”¹ä¸ºå®¢æˆ·ç«¯æ¸²æŸ“
http://localhost:3001/?seo=1&from=link

## Docker éƒ¨ç½²

**æƒé™é—®é¢˜å·²ä¿®å¤ï¼** è¯¦ç»†è¯´æ˜Žè§ä¸‹é¢çš„å¼€å‘çŽ¯å¢ƒè¯´æ˜Žã€‚

### ç”Ÿäº§çŽ¯å¢ƒ

ä½¿ç”¨ Makefile (æŽ¨è):

```bash
# æž„å»ºå¹¶å¯åŠ¨
make prod

# æˆ–åˆ†æ­¥æ‰§è¡Œ
make build
make prod

# æŸ¥çœ‹æ—¥å¿—
make logs

# é‡å¯
make restart

# è¿›å…¥å®¹å™¨
make shell

# åœæ­¢
make down

# å®Œå…¨æ¸…ç†ï¼ˆåˆ é™¤é•œåƒå’Œå·ï¼‰
make clean
```

æˆ–ç›´æŽ¥ä½¿ç”¨ Docker Compose:

```bash
# æž„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡ï¼ˆåŽå°è¿è¡Œï¼‰
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

è®¿é—®: http://localhost:3001

### å¼€å‘çŽ¯å¢ƒ

âš ï¸ **é‡è¦æç¤º**:
1. é¦–æ¬¡å¯åŠ¨å¼€å‘çŽ¯å¢ƒéœ€è¦ç­‰å¾…æž„å»ºå®Œæˆï¼ŒæœŸé—´å¯èƒ½çœ‹åˆ° `Cannot find module` é”™è¯¯ï¼Œè¿™æ˜¯æ­£å¸¸çš„
2. å¼€å‘çŽ¯å¢ƒä½¿ç”¨ volume æŒ‚è½½ï¼Œé‡åˆ°æƒé™é—®é¢˜æ—¶ä¼šè‡ªåŠ¨ä¿®å¤
3. å¦‚æžœé‡åˆ°æƒé™é”™è¯¯ï¼ˆEACCESï¼‰ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨ä¿®å¤æƒé™ï¼ˆé€šè¿‡ entrypoint.shï¼‰

```bash
# å¯åŠ¨å¼€å‘çŽ¯å¢ƒï¼ˆå¸¦çƒ­é‡è½½ï¼‰
make dev

# æŸ¥çœ‹æ—¥å¿—
make logs-dev

# è¿›å…¥å®¹å™¨
make shell-dev

# é‡å¯å¼€å‘çŽ¯å¢ƒ
make restart-dev

# é‡æ–°æž„å»ºå¹¶å¯åŠ¨
make rebuild-dev
```

æˆ–ç›´æŽ¥ä½¿ç”¨ Docker Compose:

```bash
# æž„å»ºå¹¶å¯åŠ¨å¼€å‘çŽ¯å¢ƒ
docker-compose -f docker-compose.dev.yml up --build

# åŽå°è¿è¡Œ
docker-compose -f docker-compose.dev.yml up -d --build

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.dev.yml logs -f

# åœæ­¢
docker-compose -f docker-compose.dev.yml down
```

### Docker å‘½ä»¤é€ŸæŸ¥

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# ç”Ÿäº§çŽ¯å¢ƒ
make build         # æž„å»ºé•œåƒ
make prod          # å¯åŠ¨ç”Ÿäº§çŽ¯å¢ƒ
make logs          # æŸ¥çœ‹æ—¥å¿—
make restart       # é‡å¯å®¹å™¨
make shell         # è¿›å…¥å®¹å™¨
make down          # åœæ­¢å®¹å™¨

# å¼€å‘çŽ¯å¢ƒ
make build-dev     # æž„å»ºå¼€å‘é•œåƒ
make dev           # å¯åŠ¨å¼€å‘çŽ¯å¢ƒ
make logs-dev      # æŸ¥çœ‹å¼€å‘æ—¥å¿—
make restart-dev   # é‡å¯å¼€å‘å®¹å™¨
make shell-dev     # è¿›å…¥å¼€å‘å®¹å™¨

# é€šç”¨å‘½ä»¤
make clean         # æ¸…ç†æ‰€æœ‰èµ„æºï¼ˆé•œåƒã€å·ç­‰ï¼‰
make rebuild       # é‡æ–°æž„å»ºå¹¶å¯åŠ¨ç”Ÿäº§çŽ¯å¢ƒ
make rebuild-dev   # é‡æ–°æž„å»ºå¹¶å¯åŠ¨å¼€å‘çŽ¯å¢ƒ
```

### çŽ¯å¢ƒå˜é‡

å¯åœ¨ `docker-compose.yml` æˆ– `docker-compose.dev.yml` ä¸­é…ç½®çŽ¯å¢ƒå˜é‡ï¼š

- `NODE_ENV`: è¿è¡ŒçŽ¯å¢ƒ (production/development)
- `PORT`: æœåŠ¡ç«¯å£ (é»˜è®¤ 3001)
- `ENABLE_RATE_LIMIT`: å¯ç”¨é€ŸçŽ‡é™åˆ¶ (1=å¯ç”¨ï¼Œ0=ç¦ç”¨ï¼Œé»˜è®¤ç¦ç”¨)

## å®‰å…¨ç‰¹æ€§

NSBP å†…ç½®äº†å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œé»˜è®¤å¯ç”¨ç”Ÿäº§çº§å®‰å…¨é…ç½®ï¼š

### å·²å¯ç”¨çš„å®‰å…¨æŽªæ–½

#### 1. **HTTP å¤´éƒ¨å®‰å…¨ (Helmet)**
- Content Security Policy (CSP): é˜²æ­¢ XSS æ”»å‡»
- X-Frame-Options: é˜²æ­¢ç‚¹å‡»åŠ«æŒ
- X-Content-Type-Options: é˜²æ­¢ MIME ç±»åž‹å—…æŽ¢
- Strict-Transport-Security: å¼ºåˆ¶ HTTPS
- X-XSS-Protection: XSS ä¿æŠ¤
- Referrer-Policy: æŽ§åˆ¶å¼•ç”¨ä¿¡æ¯

#### 2. **é™æ€æ–‡ä»¶å®‰å…¨**
- âœ… ç¦æ­¢è®¿é—® `.env`ã€`.git` ç­‰æ•æ„Ÿæ–‡ä»¶
- âœ… é™æ€èµ„æºç¼“å­˜ä¼˜åŒ–ï¼ˆ1 å¹´ç¼“å­˜ï¼‰
- âœ… è¯·æ±‚ä½“å¤§å°é™åˆ¶ï¼ˆ10MBï¼‰

#### 3. **æŠ€æœ¯æ ˆéšè—**
- âœ… ç§»é™¤ `X-Powered-By` å¤´éƒ¨
- âœ… ä¸æš´éœ² Express ç‰ˆæœ¬ä¿¡æ¯

#### 4. **é€ŸçŽ‡é™åˆ¶ (å¯é€‰)**
- âœ… 15 åˆ†é’Ÿå†…æœ€å¤š 100 æ¬¡è¯·æ±‚
- âœ… è‡ªåŠ¨é™æµæ¶æ„ IP
- âœ… å¯é€šè¿‡çŽ¯å¢ƒå˜é‡å¯ç”¨/ç¦ç”¨

### å¯ç”¨é€ŸçŽ‡é™åˆ¶

åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œå»ºè®®å¯ç”¨é€ŸçŽ‡é™åˆ¶ä»¥é˜²æ­¢ DDoS æ”»å‡»ï¼š

**Docker æ–¹å¼ï¼š**
```bash
# docker-compose.yml ä¸­æ·»åŠ 
environment:
  - ENABLE_RATE_LIMIT=1
```

**æœ¬åœ°å¼€å‘æ–¹å¼ï¼š**
```bash
# .env æ–‡ä»¶
ENABLE_RATE_LIMIT=1

# æˆ–å‘½ä»¤è¡Œ
ENABLE_RATE_LIMIT=1 pnpm start
```

### å®‰å…¨æœ€ä½³å®žè·µ

#### ç”Ÿäº§çŽ¯å¢ƒå»ºè®®
1. âœ… **å¯ç”¨ HTTPS**: ä½¿ç”¨åå‘ä»£ç†ï¼ˆNginx/Apacheï¼‰é…ç½® SSL
2. âœ… **å¯ç”¨é€ŸçŽ‡é™åˆ¶**: é˜²æ­¢æš´åŠ›æ”»å‡»å’Œ DDoS
3. âœ… **è®¾ç½®å¼ºå¯†ç **: æ•°æ®åº“ã€API å¯†é’¥ç­‰
4. âœ… **å®šæœŸæ›´æ–°ä¾èµ–**: `pnpm update`
5. âœ… **é…ç½®é˜²ç«å¢™**: é™åˆ¶å…¥ç«™æµé‡

#### å¼€å‘çŽ¯å¢ƒ
- âœ… é»˜è®¤é…ç½®å·²è¶³å¤Ÿ
- âŒ ä¸å»ºè®®å¯ç”¨é€ŸçŽ‡é™åˆ¶ï¼ˆå½±å“å¼€å‘æ•ˆçŽ‡ï¼‰
- âœ… ä¿ç•™è¯¦ç»†é”™è¯¯æ—¥å¿—ä¾¿äºŽè°ƒè¯•

### å®‰å…¨æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š
- [ ] å·²å®‰è£…æœ€æ–°ä¾èµ– (`pnpm install`)
- [ ] çŽ¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆNODE_ENV=productionï¼‰
- [ ] HTTPS å·²é…ç½®
- [ ] æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†é’¥ã€æ•°æ®åº“å¯†ç ï¼‰å·²ç§»å‡ºä»£ç åº“
- [ ] é€ŸçŽ‡é™åˆ¶å·²å¯ç”¨ï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰
- [ ] é™æ€æ–‡ä»¶è®¿é—®å·²æµ‹è¯•
- [ ] CSP ç­–ç•¥å·²æµ‹è¯•ï¼ˆæ£€æŸ¥æŽ§åˆ¶å°é”™è¯¯ï¼‰

### CLI å‘å¸ƒ

ä»Žé¡¹ç›®æ ¹ç›®å½•å‘å¸ƒ CLI åˆ° npm æ³¨å†Œè¡¨ï¼š

```bash
make publish-cli  # åŒæ­¥æ¨¡æ¿ã€æ›´æ–°ç‰ˆæœ¬ã€å‘å¸ƒåˆ° npm
```

æ³¨æ„ï¼šæ­¤å‘½ä»¤ä»…åœ¨é¡¹ç›®æ ¹ç›®å½•å¯ç”¨ï¼Œç”Ÿæˆçš„ NSBP é¡¹ç›®ä¸åŒ…å«æ­¤ç›®æ ‡ã€‚